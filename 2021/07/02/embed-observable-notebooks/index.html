<!DOCTYPE html>
<html lang="en">

<head>
    <title>andy reagan</title>
    <meta charset="utf-8" />
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">



<meta name="tags" contents="observable" />
<meta name="tags" contents="W209" />
<meta name="tags" contents="web development" />

    <link rel="stylesheet" type="text/css" href="/theme/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/theme/css/beemuse.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/theme/css/base.css">
    <!-- <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/default.min.css"> -->
    <!-- <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script> -->
</head>

<body>

    <section id="navbar">
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/index.html">andyreagan.com</a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li ><a href="/pages/blog.html">Blog</a></li>
                        <li ><a href="/pages/about-me.html">About</a></li>
                        <li ><a href="/pages/publications.html">Publications</a></li>
                        <li ><a href="/pages/teaching.html">Teaching</a></li>
                        <li ><a href="/pages/visualizations.html">Visualizations</a></li>
                    </ul>
                </div>
                <!--/.nav-collapse -->
            </div>
        </div>
    </section>

<br>
<section class="content">
    <div class="row">

        <div class="col-xs-12 col-md-8  col-md-offset-2 col-lg-6 col-lg-offset-3">
            <div class="paper">
                <header>
                    <h2 class="entry-title">
                        <a href="https://andyreagan.github.io/2021/07/02/embed-observable-notebooks/" rel="bookmark" title="Permalink to Embed Observable Notebooks">Embed Observable Notebooks</a></h2>
                    
                </header>
                <footer class="post-info">
                    <abbr class="published" title="2021-07-02T00:00:00+02:00">
                        Fri 02 July 2021
                    </abbr>
                    &nbsp;
                    &nbsp;
                    <a href="https://github.com/andyreagan/andyreagan.github.io/edit/main/content/2021-07-02-embed-observable-notebooks.md">Edit on Github</a>
                </footer><!-- /.post-info -->
                <br>
                <div class="entry-content">
                    <p>TL;DR: Use all of the cool examples with your own data, while keeping that data local or inside your network.</p>
<p>If you haven’t heard of it,
<a href="https://observablehq.com/trending">Observable</a> is a platform for interactive coding brought to the world by Mike Bostock, creator of d3.
It embodies a bold vision of <a href="https://www.youtube.com/watch?v=8pTEmbeENF4">reactive programming from Bret Victor</a> and frankly,
I think it’s cool as hell.
One drawback:
I’m not the best at Javascript, the core language.
I’m pretty darn good at it,
don’t get me wrong,
but I’m continually impressed at the things people do on Observable.
At the risk of repeating the excellent guides from the Observable team,
I’ll just share a concrete example.</p>
<p>If you get stuck on my guide, the definitive references are
<a href="https://observablehq.com/@observablehq/introduction-to-embedding">Introduction to Embedding</a>,
<a href="https://observablehq.com/@observablehq/downloading-and-embedding-notebooks?collection=@observablehq/embed-trail">Advanced Embedding and Downloading</a>,
and <a href="https://observablehq.com/@observablehq/troubleshooting-embedding?collection=@observablehq/embedding-notebooks">Troubleshooting Embedding</a>.</p>
<p>Now let’s get going.
There are two excellent example visualizations from Mike Bostock showcasing d3:
<a href="https://observablehq.com/@d3/line-chart-with-tooltip">Line Chart with Tooltip</a> and
<a href="https://observablehq.com/@d3/calendar-view">Calendar View</a>.
I was showing my UC Berkeley MIDS class the latter,
and we were curious what the data shown in the calendar view would look like in the line chart.
Start by downloading the data from the calendar view:</p>
<p><img src="/images/2021-07-02-embed-observable-notebooks/1.png" class="img-responsive"></p>
<p>Now that we have the data,
let’s create the embed.
From the line chart,
click the three dots in the top right and select embed:</p>
<p><img src="/images/2021-07-02-embed-observable-notebooks/2.png" class="img-responsive"></p>
<p>Now we just want the chart,
so select only the chart.
Make sure get “Runtime with JavaScript” so we can override the data.</p>
<p><img src="/images/2021-07-02-embed-observable-notebooks/3.png" class="img-responsive"></p>
<p>You should now have that snippet of code:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;observablehq-chart-22ee36d2&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Credit: <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://observablehq.com/@d3/line-chart-with-tooltip&quot;</span><span class="p">&gt;</span>Line Chart with Tooltip by D3<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span><span class="p">&gt;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">Runtime</span><span class="p">,</span><span class="w"> </span><span class="nx">Inspector</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">define</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;https://api.observablehq.com/@d3/line-chart-with-tooltip.js?v=3&quot;</span><span class="p">;</span>
<span class="ow">new</span><span class="w"> </span><span class="nx">Runtime</span><span class="p">().</span><span class="nx">module</span><span class="p">(</span><span class="nx">define</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;chart&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Inspector</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#observablehq-chart-22ee36d2&quot;</span><span class="p">));</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div>

<p>Fire up an empty <code>index.html</code> next to the <code>data.json</code> that you already downloaded,
and we’ll wrap that embed in an HTML container
(in my Atom editor, I just type html and use the completion to get the “shell”).
It should look like this:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span> <span class="na">dir</span><span class="o">=</span><span class="s">&quot;ltr&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;observablehq-chart-b01c95fe&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">Runtime</span><span class="p">,</span><span class="w"> </span><span class="nx">Inspector</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="k">import</span><span class="w"> </span><span class="nx">define</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;https://api.observablehq.com/@d3/line-chart-with-tooltip.js?v=3&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="ow">new</span><span class="w"> </span><span class="nx">Runtime</span><span class="p">().</span><span class="nx">module</span><span class="p">(</span><span class="nx">define</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;chart&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Inspector</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#observablehq-chart-b01c95fe&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;yAxis&quot;</span><span class="p">,</span><span class="s2">&quot;bisect&quot;</span><span class="p">,</span><span class="s2">&quot;  xAxis&quot;</span><span class="p">,</span><span class="s2">&quot;line&quot;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>Now we’ll load the data, by first loading the d3 library and using it to get the JSON file:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span> <span class="na">dir</span><span class="o">=</span><span class="s">&quot;ltr&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;observablehq-chart-b01c95fe&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://d3js.org/d3.v7.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">Runtime</span><span class="p">,</span><span class="w"> </span><span class="nx">Inspector</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="k">import</span><span class="w"> </span><span class="nx">define</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;https://api.observablehq.com/@d3/line-chart-with-tooltip.js?v=3&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Runtime</span><span class="p">().</span><span class="nx">module</span><span class="p">(</span><span class="nx">define</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;chart&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Inspector</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#observablehq-chart-b01c95fe&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;yAxis&quot;</span><span class="p">,</span><span class="s2">&quot;bisect&quot;</span><span class="p">,</span><span class="s2">&quot;  xAxis&quot;</span><span class="p">,</span><span class="s2">&quot;line&quot;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="nx">d3</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="s2">&quot;data.json&quot;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">[</span><span class="nx">next</span><span class="w"> </span><span class="nx">bit</span><span class="w"> </span><span class="nx">goes</span><span class="w"> </span><span class="nx">here</span><span class="p">]</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>Okay, I did more than just load d3 and the data.
See what else?
I also stuck the runtime in a variable that I called "main" with <code>const main = ...</code>.</p>
<p>Finally,
we just need to override the data on that runtime,
once it’s loaded.
To avoid repeating the whole block of code again,
we’ll just replace <code>[next bit goes here]</code> with our override.
Let’s do it,
first making <code>Date</code> objects out of the dates and adding the axis label,
then overriding the data:</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">newData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">map</span><span class="p">(({</span><span class="nx">date</span><span class="p">,</span><span class="w"> </span><span class="nx">close</span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">),</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="nx">close</span><span class="p">})),</span><span class="w"> </span><span class="p">{</span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$ Close&quot;</span><span class="p">});</span>
<span class="nx">main</span><span class="p">.</span><span class="nx">redefine</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">newData</span><span class="p">);</span>
</code></pre></div>

<p>And it should work!
Since we’re requesting <code>data.json</code> from the local filesystem,
to view the <code>index.html</code> file you’ll need a local server
(your browser is protecting you from malicious JS files!).
Out of ease, I usually just spin up a python server with</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>http.server
</code></pre></div>

<p>while navigating on over to http://localhost:8000/ to see the finished product:</p>
<p><img src="/images/2021-07-02-embed-observable-notebooks/4.png" class="img-responsive"></p>
<p>Cheers!</p>
                </div> <!-- /.entry-content -->
            </div> <!-- /.paper -->
        </div> <!-- /.col -->
    </div> <!-- /.row -->
</section><!-- /#content -->

    <footer id="slidingfooter" class="body">
        Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>. Site design by Andy Reagan.
    </footer><!-- /#contentinfo -->
</body>
</script>

</html>